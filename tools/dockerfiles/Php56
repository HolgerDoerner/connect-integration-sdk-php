FROM php:5.6-cli-stretch

ARG ENABLE_XDEBUG

RUN apt-get update && apt-get install -y zip git iproute2 iputils-ping &&\
    curl https://getcomposer.org/installer -o composer-setup.php &&\
    php composer-setup.php --install-dir=/usr/local/bin --filename=composer &&\
    if [ ! -z "$ENABLE_XDEBUG" ]; then pecl install -f xdebug-2.5.5 && docker-php-ext-enable xdebug; fi &&\
    mkdir -p /src/xdebug && touch /src/xdebug/xdebug.log && chmod 0666 /src/xdebug/xdebug.log &&\
    php -v

WORKDIR /sdk

COPY ./ /sdk/
COPY ./tools/fixtures/env /sdk/tests/Integration/.env
COPY ./tools/config/setup.sh /setup.sh
COPY ./tools/config/xdebug.ini /usr/local/etc/php/conf.d/xdebug.ini

CMD ["/setup.sh"]